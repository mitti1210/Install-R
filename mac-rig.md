# macOS: rig で R をバージョン管理する方法

ターミナルの開き方やコマンドの貼り付け方から丁寧に説明します。

## 0. ターミナルを開く

1. 画面左上の **Finder**（顔のアイコン）をクリックします。
2. メニューから **アプリケーション > ユーティリティ** を開き、**ターミナル** をダブルクリックします。
   - 検索欄で `ターミナル` と入力しても開けます。
3. 黒い画面が開き、ここに文字を入力します。これを **ターミナル（コマンドライン）** と呼びます。
   - ここに出てくる命令文をマウスで選択し、`⌘ + C` でコピー、ターミナルで `⌘ + V` で貼り付け、
     **Enter キー**を押すだけで実行できます。
   - 画面に `~ %` が表示されているときに入力できます。表示されていない間は前のコマンドが処理中なので、`~ %` が再び出るまで待ちます。
   - パスワードの入力を求められた場合、画面には文字が表示されませんが、そのまま入力して **Enter キー** を押してください。

## 1. CPU アーキテクチャの確認

あなたの Mac が Apple シリコン(arm64) か Intel(x86_64) かを確認します。
ターミナルに次を貼り付け、Enter を押します。

```bash
uname -m
```

<!-- TODO: `uname -m` の実行結果のスクリーンショットを挿入（mac-homebrew.md を参照） -->

`arm64` なら Apple シリコン、`x86_64` なら Intel です。後の手順で迷ったときの目印になります。

## 2. rig のインストール

**rig** は R のバージョンを簡単に切り替えるための道具です。
まだ入っていない場合は次の手順でインストールします。

1. ブラウザで [rig のリリースページ](https://github.com/r-lib/rig/releases) を開きます。
2. 一覧の中から最新の `rig-*-macos.pkg` を探し、クリックしてダウンロードします。
   - Apple シリコンならファイル名に `arm64`、Intel なら `x86_64` が含まれているものを選びます。
3. ダウンロードした `.pkg` ファイルをダブルクリックし、画面の指示に従ってインストールします。
4. インストールが終わったらターミナルを一度閉じ、もう一度開きます。

<!-- TODO: rig のリリースページやインストーラーのスクリーンショットを挿入予定 -->

## 3. rig で R をインストールする

1. **rig が入ったか確認**

    ```bash
    rig --version
    ```

    <img width="519" height="46" alt="image" src="https://github.com/user-attachments/assets/f3e8952d-ac02-4b3c-a8ad-29a167f84556" />

    バージョン番号が表示されれば成功です。

2. **インストールできる R の一覧を見る**

    ```bash
    rig available
    ```

    どのバージョンの R を用意できるかが表示されます。

3. **最新の R をインストール**

    ```bash
    rig add release
    ```

    `release` は「一番新しい安定版」を意味します。通常はこれだけで十分です。  
    *もし特定のバージョンを入れたい場合だけ* 次のように数字を指定します。

    ```bash
    rig add 4.4.3
    ```

4. **インストール済み R を確認**

    ```bash
    rig list
    ```

    <img width="444" height="112" alt="image" src="https://github.com/user-attachments/assets/f763d83c-e04b-412b-9362-dd3b13387e36" />

    1つだけ入っているならそのバージョンだけが表示されます。  
    2つ以上入れた場合は上図のように一覧を確認できます。  
    *がついているのが現在使っているバージョン (default) です。今は `R4.4.3` になっています。  
    `rig` で入れた R だけが表示されるため、別の方法で入れた R は必要なら `rig add` で入れ直してください。

5. **使う R のバージョンを切り替える（複数バージョンをインストールしている場合のみ）**

    ```bash
    rig default 4.5.1
    ```

    上記を入力すると先程 default だった `R4.4.3` から `R4.5.1` に切り替わります（`rig list` で確認可能）。  
    バージョンを複数入れているときだけ必要な操作です。  
    1つしか入っていないなら何もしなくて大丈夫です。

## 4. XQuartz をインストール（必要な人のみ）

**R Commander や EZR、3D グラフを使いたい方向け**の追加作業です。X11 を利用するこれらの機能には **XQuartz 2.8.5 以降** が必要です。
[CRAN の macOS 用ページ](https://cran.rstudio.com/bin/macosx/) にリンクがあります。macOS をメジャーバージョンアップしたら XQuartz も再インストールしてください。
<https://www.xquartz.org> からダウンロードし、通常のアプリと同じようにインストールします。

## 5. RStudio をインストール

**RStudio** は R を使いやすくするアプリです。
ブラウザで [RStudio のダウンロードページ](https://posit.co/download/rstudio-desktop/) を開きます。

1. `Download RStudio for Mac` をクリックし、`RStudio.dmg` をダウンロードします。
2. 5. ダウンロードした `.dmg` ファイルをダブルクリックし、表示されるウインドウから **RStudio** を **アプリケーション** フォルダにドラッグします。その後ディスクイメージをイジェクトしてください。

<img width="140" height="56" alt="image" src="https://github.com/user-attachments/assets/9816a752-b003-4536-8140-58ae54bce47f" style="border: 1px solid #000;" />

<img width="125" height="32" alt="image" src="https://github.com/user-attachments/assets/d7af3fc8-cb49-4ad3-a8da-924ded90b3f0" />

## 6. RStudio の初期設定とパッケージのインストール

RStudio の初期設定や必要なパッケージの導入については [RStudioインストール後の準備について](rstudio-post-install.md) を参照してください。
